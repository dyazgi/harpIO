<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="harpIO">
<title>Transforming forecast model data • harpIO</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Transforming forecast model data">
<meta property="og:description" content="harpIO">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">harpIO</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/file_options.html">Options for file formats</a>
    <a class="dropdown-item" href="../articles/read_csv_obs.html">Read observations from CSV files</a>
    <a class="dropdown-item" href="../articles/read_raw_forecast.html">Reading forecast model data</a>
    <a class="dropdown-item" href="../articles/transformations.html">Transforming forecast model data</a>
    <a class="dropdown-item" href="../articles/write_forecast_data.html">Writing forecast model data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/harphub/harpIO/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Transforming forecast model data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/harphub/harpIO/blob/HEAD/vignettes/transformations.Rmd" class="external-link"><code>vignettes/transformations.Rmd</code></a></small>
      <div class="d-none name"><code>transformations.Rmd</code></div>
    </div>

    
    
<style>
body {
text-align: justify;
}
</style>
<p>As discussed in the <a href="read_raw_forecast.html">Reading forecast
model data</a> guide, forecast model data can be read with the
<code><a href="../reference/read_forecast.html">read_forecast()</a></code> function. However, in many cases you may
want to interpolate those data to point locations, such as weather
stations; or transform the data to a different grid, maybe with a
different projection; or to obtain a vertical cross section of the data.
In harp, we call these operations transformations and they are done via
the <code>transformation</code> argument to
<code><a href="../reference/read_forecast.html">read_forecast()</a></code>. Three transformations are possible:
“interpolate”, “regrid”, and “xsection”. Different options for these
transformations are set via the <code>transformation_opts</code>
argument.</p>
<div class="section level2">
<h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>For all of these examples we will use data provided in the harpData
package, which, if you haven’t done so already, you can install
with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"harphub/harpData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="interpolate">Interpolate<a class="anchor" aria-label="anchor" href="#interpolate"></a>
</h2>
<p>To interpolate forecast data to points, set
<code>transformation = "interpolate"</code> in the call to
<code><a href="../reference/read_forecast.html">read_forecast()</a></code>. harp has a built in list of weather
stations, <code>station_list</code>, that was taken from the list of all
WMO SYNOP stations in 2018. The default is to interpolate to all of
these stations that exist within the forecast model domain. In the below
example, AROME_Arctic data are interpolated to stations within that
domain.</p>
<p>First attach the harpIO package (you could equally attach harp, which
automatically attaches all harp packages)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/harphub/harpIO" class="external-link">harpIO</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Loading required package: harpCore</span></span></code></pre>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'harpCore'</span></span></code></pre>
<pre><code><span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter</span></span></code></pre>
<p>Then we are going to read in the AROME_Arctic data for 10m wind speed
(S10m) adding <code>transformation = "interpolate"</code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_forecast.html">read_forecast</a></span><span class="op">(</span></span>
<span>  <span class="fl">2018071000</span>,</span>
<span>  <span class="st">"AROME_Arctic"</span>,</span>
<span>  <span class="st">"S10m"</span>,</span>
<span>  transformation <span class="op">=</span> <span class="st">"interpolate"</span>,</span>
<span>  file_path      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"grib/AROME_Arctic"</span>, package <span class="op">=</span> <span class="st">"harpData"</span><span class="op">)</span>,</span>
<span>  file_template  <span class="op">=</span> <span class="st">"harmonie_grib_fp"</span>,</span>
<span>  return_data    <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Warning: 'transformation_opts' not set for transformation = 'interpolate'.</span></span>
<span><span class="co">#&gt; Using default interpolate_opts()</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">::deterministic point forecast:: </span><span style="color: #949494;"># A tibble: 119 × 14</span></span></span>
<span><span class="co">#&gt;    fcst_model   fcst_dttm           lead_time parameter valid_dttm         </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>         0 S10m      2018-07-10 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>         0 S10m      2018-07-10 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>         0 S10m      2018-07-10 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>         0 S10m      2018-07-10 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>         0 S10m      2018-07-10 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>         0 S10m      2018-07-10 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>         0 S10m      2018-07-10 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>         3 S10m      2018-07-10 <span style="color: #949494;">03:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>         3 S10m      2018-07-10 <span style="color: #949494;">03:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>         3 S10m      2018-07-10 <span style="color: #949494;">03:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 109 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9 more variables: step_range &lt;chr&gt;, level_type &lt;chr&gt;, level &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   units &lt;chr&gt;, SID &lt;int&gt;, lat &lt;dbl&gt;, lon &lt;dbl&gt;, fcst_cycle &lt;chr&gt;, fcst &lt;dbl&gt;</span></span></span></code></pre>
<p>You will see a warning and a couple of messages. The warning states
that <code><a href="../reference/read_forecast.html">read_forecast()</a></code> did not receive any options for the
interpolation so it is using the default options with the default
station list. Furthermore, you will see that interpolate weights are
being derived from ‘sfc_geo’ - this is the default behaviour so that if
corrections are to be made for 2m temperature for elevation differences
between the model and reality.</p>
<div class="section level3">
<h3 id="interpolate-options">Interpolate options<a class="anchor" aria-label="anchor" href="#interpolate-options"></a>
</h3>
<p>Options for interpolation are set using the
<code><a href="../reference/interpolate_opts.html">interpolate_opts()</a></code> function and passed to
<code><a href="../reference/read_forecast.html">read_forecast()</a></code> via the <code>transformation_opts</code>
argument. You can see options are available and their defaults by
running <code>interpolate_opts</code></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/interpolate_opts.html">interpolate_opts</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; No stations specified. Using default stations: 'station_list'</span></span></code></pre>
<pre><code><span><span class="co">#&gt; $stations</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 13,417 × 5</span></span></span>
<span><span class="co">#&gt;      SID   lat   lon  elev name         </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">1</span>001  70.9 -<span style="color: #BB0000;">8.67</span>   9.4 JAN MAYEN    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">1</span>002  80.1 16.2    8   VERLEGENHUKEN</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">1</span>003  77   15.5   11.1 HORNSUND     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">1</span>004  78.9 11.9    8   NY-ALESUND II</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">1</span>006  78.3 22.8   14   EDGEOYA      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">1</span>007  78.9 11.9    7.7 NY-ALESUND   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">1</span>008  78.2 15.5   26.8 SVALBARD AP  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">1</span>009  80.7 25.0    5   KARL XII OYA </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">1</span>010  69.3 16.1   13.1 ANDOYA       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">1</span>011  80.1 31.5   10   KVITOYA      </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 13,407 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $method</span></span>
<span><span class="co">#&gt; [1] "nearest"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $correct_t2m</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $keep_model_t2m</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $lapse_rate</span></span>
<span><span class="co">#&gt; [1] 0.0065</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $clim_file</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $clim_file_format</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $clim_file_opts</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $clim_param</span></span>
<span><span class="co">#&gt; [1] "sfc_geo"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $use_mask</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $weights</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $keep_raw_data</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre>
<p>We can use <code><a href="../reference/interpolate_opts.html">interpolate_opts()</a></code> to set the points to which
we want to interpolate, by setting stations as a data frame (if you do
not use the default <code>station_list</code>, this would normally be
read in from an external source rather than set manually). It is
important that the data frame includes columns “SID”, “lat”, “lon” and,
optionally, “elev”, where “SID” a unique station ID and “elev” is the
elevation of the station in meters.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  SID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1003</span>, <span class="fl">1004</span>, <span class="fl">1006</span><span class="op">)</span>,</span>
<span>  lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">77.0000</span>, <span class="fl">78.9167</span>, <span class="fl">78.2506</span><span class="op">)</span>,</span>
<span>  lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15.5000</span>, <span class="fl">11.9331</span>, <span class="fl">22.8225</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">my_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/interpolate_opts.html">interpolate_opts</a></span><span class="op">(</span>stations <span class="op">=</span> <span class="va">my_stations</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Warning: No 'elev' column found in stations, and correct_t2m = TRUE. Setting</span></span>
<span><span class="co">#&gt; correct_t2m = FALSE</span></span></code></pre>
<p>You will see a warning that no “elev” column was found and
<code>correct_t2m</code> is being set to FALSE. When interpolating 2m
temperature an attempt is made to make a correction due to the
difference in height between the model and reality using a simple lapse
rate that can be changed from the default of 0.0065 K/m with the
<code>lapse_rate</code> argument. If the station elevation is not
available, this cannot be done. Furthermore, if the 2m correction is
done, the uncorrected model temperature is discarded, but can be kept by
setting <code>keep_model_2m = TRUE</code>. Finally, if the first
forecast file does not contain surface geopotential, or model orography
a “clim file” can be passed that does contain this information on the
same grid as the forecast files. Additionally the parameter to read from
the clim file can be set - this would normally by “sfc_geo” or
“oro”.</p>
<p>To demonstrate all of this, let’s add an “elev” column (with fake
data) to our small station list and read the 2m temperature while
keeping the uncorrected model 2m temperature and manually setting a clim
file.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_stations</span><span class="op">$</span><span class="va">elev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">145</span>, <span class="fl">233</span>, <span class="fl">308</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/interpolate_opts.html">interpolate_opts</a></span><span class="op">(</span></span>
<span>  stations       <span class="op">=</span> <span class="va">my_stations</span>,</span>
<span>  keep_model_t2m <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  clim_file      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>    <span class="st">"grib/AROME_Arctic/2018/07/10/00/fc2018071000+048grib_fp"</span>, </span>
<span>    package <span class="op">=</span> <span class="st">"harpData"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">t2m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_forecast.html">read_forecast</a></span><span class="op">(</span></span>
<span>  <span class="fl">2018071000</span>,</span>
<span>  <span class="st">"AROME_Arctic"</span>,</span>
<span>  <span class="st">"T2m"</span>,</span>
<span>  transformation      <span class="op">=</span> <span class="st">"interpolate"</span>,</span>
<span>  transformation_opts <span class="op">=</span> <span class="va">my_options</span>,</span>
<span>  file_path           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"grib/AROME_Arctic"</span>, package <span class="op">=</span> <span class="st">"harpData"</span><span class="op">)</span>,</span>
<span>  file_template       <span class="op">=</span> <span class="st">"harmonie_grib_fp"</span>,</span>
<span>  return_data         <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>To show the effect of the correction to 2m temperature, we can just
show the relevant columns using the <code>select</code> method from the
dplyr package, and bringing T2m and T2m_uncorrected into their own
columns using the <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider()</a></code> function from the tidyr
package.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">t2m</span>, <span class="va">SID</span>, <span class="va">lead_time</span>, <span class="va">parameter</span>, <span class="va">fcst</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">parameter</span>, values_from <span class="op">=</span> <span class="va">fcst</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 51 × 4</span></span></span>
<span><span class="co">#&gt;      SID lead_time T2m_uncorrected   T2m</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">1</span>003         0            277.  276.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">1</span>004         0            277.  276.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">1</span>006         0            278.  276.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">1</span>003         3            277.  277.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">1</span>004         3            276.  276.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">1</span>006         3            278.  276.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">1</span>003         6            277.  277.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">1</span>004         6            276.  276.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">1</span>006         6            278.  276.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">1</span>003         9            277.  277.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 41 more rows</span></span></span></code></pre>
<p>As you will see the uncorrected temperatures are higher as we set
artificially high elevations for the elevation in my_stations.</p>
</div>
</div>
<div class="section level2">
<h2 id="regrid">Regrid<a class="anchor" aria-label="anchor" href="#regrid"></a>
</h2>
<p>Regridding is done in much the same way as interpolating to points,
except you set <code>transformation = "regrid"</code> and the options
are generated using <code><a href="../reference/interpolate_opts.html">regrid_opts()</a></code>. Unlike for interpolation
<code>transformation_opts</code> must be set other
<code><a href="../reference/read_forecast.html">read_forecast()</a></code> won’t know what grid to which to regrid the
data. The most important argument to <code><a href="../reference/interpolate_opts.html">regrid_opts()</a></code> is
<code>new_domain</code>. This defines the domain that to which the data
will be regridded. It must be a “geofield” or “geodomain” object - all
gridded data read in by <code><a href="../reference/read_forecast.html">read_forecast()</a></code> or
<code><a href="../reference/read_grid.html">read_grid()</a></code> are automatically coerced into geofields, or a
geodomain can be defined using <a href="https://github.com/harphub/harpCore" class="external-link">harpCore’s</a>
<code><a href="https://rdrr.io/pkg/harpCore/man/define_domain.html" class="external-link">define_domain()</a></code> function.</p>
<p>We will demonstrate regridding by making a domain with 10km
resolution based on the AROME_Arctic domain.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">meteogrid</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_domain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpCore/man/define_domain.html" class="external-link">define_domain</a></span><span class="op">(</span></span>
<span>  centre_lon <span class="op">=</span> <span class="fl">15.57905</span>,</span>
<span>  centre_lat <span class="op">=</span> <span class="fl">78.21638</span>,</span>
<span>  nxny    <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  dxdy    <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  reflat  <span class="op">=</span> <span class="fl">77.5</span>,</span>
<span>  reflon  <span class="op">=</span> <span class="op">-</span><span class="fl">25</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/interpolate_opts.html">regrid_opts</a></span><span class="op">(</span>new_domain <span class="op">=</span> <span class="va">my_domain</span>, keep_raw_data <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>In the above, <code>keep_raw_data = TRUE</code>, which means that
both the original fields and the regridded fields are kept so that we
can compare them. If <code>keep_raw_data</code> is not set, then the
original data before regridding will be discarded.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s10m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_forecast.html">read_forecast</a></span><span class="op">(</span></span>
<span>  <span class="fl">2018071000</span>,</span>
<span>  <span class="st">"AROME_Arctic"</span>,</span>
<span>  <span class="st">"S10m"</span>,</span>
<span>  transformation      <span class="op">=</span> <span class="st">"regrid"</span>,</span>
<span>  transformation_opts <span class="op">=</span> <span class="va">my_options</span>,</span>
<span>  file_path           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"grib/AROME_Arctic"</span>, package <span class="op">=</span> <span class="st">"harpData"</span><span class="op">)</span>,</span>
<span>  file_template       <span class="op">=</span> <span class="st">"harmonie_grib_fp"</span>,</span>
<span>  return_data         <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can now plot the two fields using <code><a href="https://rdrr.io/pkg/harpVis/man/plot_field.html" class="external-link">plot_field()</a></code> from
the harpVis package.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/harphub/harpVis" class="external-link">harpVis</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Loading required package: ggplot2</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Loading required package: shiny</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="https://rdrr.io/pkg/harpVis/man/plot_field.html" class="external-link">plot_field</a></span><span class="op">(</span></span>
<span>   <span class="va">s10m</span>, </span>
<span>   fcst_model <span class="op">=</span> <span class="st">"AROME_Arctic"</span>, </span>
<span>   plot_col   <span class="op">=</span> <span class="va">gridded_data</span>, </span>
<span>   lead_time  <span class="op">=</span> <span class="fl">0</span>, </span>
<span>   breaks     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">2</span><span class="op">)</span></span>
<span> <span class="op">)</span></span></code></pre></div>
<p><img src="transformations_files/figure-html/plot-1.png" width="768"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># </span></span>
<span> <span class="fu"><a href="https://rdrr.io/pkg/harpVis/man/plot_field.html" class="external-link">plot_field</a></span><span class="op">(</span></span>
<span>   <span class="va">s10m</span>, </span>
<span>   fcst_model <span class="op">=</span> <span class="st">"AROME_Arctic"</span>, </span>
<span>   plot_col   <span class="op">=</span> <span class="va">regridded_data</span>, </span>
<span>   lead_time  <span class="op">=</span> <span class="fl">0</span>, </span>
<span>   breaks     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">2</span><span class="op">)</span></span>
<span> <span class="op">)</span></span></code></pre></div>
<p><img src="transformations_files/figure-html/plot-2.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="xsection">Xsection<a class="anchor" aria-label="anchor" href="#xsection"></a>
</h2>
<p>Coming Soon!!!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Andrew Singleton, Alex Deckmyn.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
