<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="harpIO">
<title>Options for file formats • harpIO</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Options for file formats">
<meta property="og:description" content="harpIO">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">harpIO</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/file_options.html">Options for file formats</a>
    <a class="dropdown-item" href="../articles/read_raw_forecast.html">Reading forecast model data</a>
    <a class="dropdown-item" href="../articles/transformations.html">Transforming forecast model data</a>
    <a class="dropdown-item" href="../articles/write_forecast_data.html">Writing forecast model data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/harphub/harpIO/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Options for file formats</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/harphub/harpIO/blob/HEAD/vignettes/file_options.Rmd" class="external-link"><code>vignettes/file_options.Rmd</code></a></small>
      <div class="d-none name"><code>file_options.Rmd</code></div>
    </div>

    
    
<p>For this vignette, we will use the {harpIO} and {dplyr} packages.
Note that {dplyr} is only used for the <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">dplyr::select()</a></code>
function to remove some columns from data frames so that they are not
too wide for the vignette!</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/harphub/harpIO" class="external-link">harpIO</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>{harpIO} is able to read data from several different file formats.
This is includes grib (both editions 1 and 2), netcdf, FA and vfld /
vobs. In most cases, reading forecast data with the
<code><a href="../reference/read_forecast.html">read_forecast()</a></code> function is straightforward, but there are
some issues that need to be taken into account for some formats. This
vignette describes the extra options for grib and netcdf file
formats.</p>
<div class="section level2">
<h2 id="grib-files">Grib files<a class="anchor" aria-label="anchor" href="#grib-files"></a>
</h2>
<p>Grib files have long been used to store meteorological data. They are
a binary data format and store “messages” as 2d fields. Each message is
accompanied by metadata that describe the geographic projection of the
data and the grid that they are on. This metadata also includes
key-value pairs that describe what the data are - i.e. the parameter,
what vertical level they are on, etc. {harpIO} harnesses the {Rgrib2}
package to read data from grib files, making use of the key-value pairs
to extract the correct 2d fields from the files. Behind the scenes,
{Rgirb2} uses the <a href="https://confluence.ecmwf.int/display/ECC/ecCodes+Home" class="external-link">ecCodes</a>
system library, which includes lookup tables for many different
operational centres.</p>
<p>For built in harp parameters (see
<code>show_harp_parameters()</code>), the extraction of grib messages is
done based on the grib <em>shortName</em>,
<em>indicatorOfTypeOfLevel</em>, <em>level</em>, <em>dataDate</em>,
<em>dataTime</em> and <em>stepRange</em> keys. Additionally, for
ensemble forecasts the <em>perturbationNumber</em> key is used when
different ensemble members are in the same file. In some cases, the
values used for these keys may not be compatible with the key-value
pairs used in some grib files. For example, different forecast centres
may use values for the shortName key that are not listed in the lookup
tables that are included with ecCodes, or store fields on vertical
levels that are not consistent with what {harpIO} expects. In order to
address the <code><a href="../reference/grib_opts.html">grib_opts()</a></code> function can be used to set the
<code>file_format_opts</code> argument in calls to
<code><a href="../reference/read_forecast.html">read_forecast()</a></code> or <code><a href="../reference/read_grid.html">read_grid()</a></code> so that
specific key-value pairs can be used to override those built in to
{harpIO}.</p>
<p>In the following examples, we will use <code><a href="../reference/read_grid.html">read_grid()</a></code> to
read gridded data from a grib file in the {harpData} package, so first
we create the path to the file. We export this to a system variable so
that</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grib_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"grib/AROME_Arctic/2018/07/10/00/fc2018071000+006grib_fp"</span>, </span>
<span>  package <span class="op">=</span> <span class="st">"harpData"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can then use the system command, <code>grib_ls</code> from ecCodes
to get a summary of the content of the grib file. The -p tag is used to
just select the keys we might be interested in.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>    <span class="st">"grib_ls"</span>,</span>
<span>    <span class="st">"-p shortName,indicatorOfParameter,typeOfLevel,level"</span>, </span>
<span>    <span class="va">grib_file</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; shortName             indicatorOfParameter  typeOfLevel           level                 </span></span>
<span><span class="co">#&gt; t                     11                    heightAboveGround     0                    </span></span>
<span><span class="co">#&gt; z                     6                     heightAboveGround     0                    </span></span>
<span><span class="co">#&gt; t                     11                    heightAboveGround     2                    </span></span>
<span><span class="co">#&gt; q                     51                    heightAboveGround     2                    </span></span>
<span><span class="co">#&gt; u                     33                    heightAboveGround     10                   </span></span>
<span><span class="co">#&gt; v                     34                    heightAboveGround     10                   </span></span>
<span><span class="co">#&gt; tcc                   71                    heightAboveGround     0                    </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         50                   </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         100                  </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         150                  </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         200                  </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         250                  </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         300                  </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         400                  </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         500                  </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         600                  </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         700                  </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         800                  </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         850                  </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         900                  </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         925                  </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         950                  </span></span>
<span><span class="co">#&gt; u                     33                    isobaricInhPa         1000                 </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         50                   </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         100                  </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         150                  </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         200                  </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         250                  </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         300                  </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         400                  </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         500                  </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         600                  </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         700                  </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         800                  </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         850                  </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         900                  </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         925                  </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         950                  </span></span>
<span><span class="co">#&gt; v                     34                    isobaricInhPa         1000                 </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         50                   </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         100                  </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         150                  </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         200                  </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         250                  </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         300                  </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         400                  </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         500                  </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         600                  </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         700                  </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         800                  </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         850                  </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         900                  </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         925                  </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         950                  </span></span>
<span><span class="co">#&gt; t                     11                    isobaricInhPa         1000                 </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         50                   </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         100                  </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         150                  </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         200                  </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         250                  </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         300                  </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         400                  </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         500                  </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         600                  </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         700                  </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         800                  </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         850                  </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         900                  </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         925                  </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         950                  </span></span>
<span><span class="co">#&gt; q                     51                    isobaricInhPa         1000                 </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         50                   </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         100                  </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         150                  </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         200                  </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         250                  </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         300                  </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         400                  </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         500                  </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         600                  </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         700                  </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         800                  </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         850                  </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         900                  </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         925                  </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         950                  </span></span>
<span><span class="co">#&gt; z                     6                     isobaricInhPa         1000                 </span></span>
<span><span class="co">#&gt; pres                  1                     heightAboveSea        0                    </span></span>
<span><span class="co">#&gt; u                     33                    heightAboveGround     20                   </span></span>
<span><span class="co">#&gt; u                     33                    heightAboveGround     50                   </span></span>
<span><span class="co">#&gt; u                     33                    heightAboveGround     100                  </span></span>
<span><span class="co">#&gt; u                     33                    heightAboveGround     250                  </span></span>
<span><span class="co">#&gt; u                     33                    heightAboveGround     500                  </span></span>
<span><span class="co">#&gt; u                     33                    heightAboveGround     750                  </span></span>
<span><span class="co">#&gt; u                     33                    heightAboveGround     1000                 </span></span>
<span><span class="co">#&gt; u                     33                    heightAboveGround     1250                 </span></span>
<span><span class="co">#&gt; u                     33                    heightAboveGround     1500                 </span></span>
<span><span class="co">#&gt; u                     33                    heightAboveGround     2000                 </span></span>
<span><span class="co">#&gt; u                     33                    heightAboveGround     2500                 </span></span>
<span><span class="co">#&gt; u                     33                    heightAboveGround     3000                 </span></span>
<span><span class="co">#&gt; v                     34                    heightAboveGround     20                   </span></span>
<span><span class="co">#&gt; v                     34                    heightAboveGround     50                   </span></span>
<span><span class="co">#&gt; v                     34                    heightAboveGround     100                  </span></span>
<span><span class="co">#&gt; v                     34                    heightAboveGround     250                  </span></span>
<span><span class="co">#&gt; v                     34                    heightAboveGround     500                  </span></span>
<span><span class="co">#&gt; v                     34                    heightAboveGround     750                  </span></span>
<span><span class="co">#&gt; v                     34                    heightAboveGround     1000                 </span></span>
<span><span class="co">#&gt; v                     34                    heightAboveGround     1250                 </span></span>
<span><span class="co">#&gt; v                     34                    heightAboveGround     1500                 </span></span>
<span><span class="co">#&gt; v                     34                    heightAboveGround     2000                 </span></span>
<span><span class="co">#&gt; v                     34                    heightAboveGround     2500                 </span></span>
<span><span class="co">#&gt; v                     34                    heightAboveGround     3000                 </span></span>
<span><span class="co">#&gt; t                     11                    heightAboveGround     20                   </span></span>
<span><span class="co">#&gt; t                     11                    heightAboveGround     50                   </span></span>
<span><span class="co">#&gt; t                     11                    heightAboveGround     100                  </span></span>
<span><span class="co">#&gt; t                     11                    heightAboveGround     250                  </span></span>
<span><span class="co">#&gt; t                     11                    heightAboveGround     500                  </span></span>
<span><span class="co">#&gt; t                     11                    heightAboveGround     750                  </span></span>
<span><span class="co">#&gt; t                     11                    heightAboveGround     1000                 </span></span>
<span><span class="co">#&gt; t                     11                    heightAboveGround     1250                 </span></span>
<span><span class="co">#&gt; t                     11                    heightAboveGround     1500                 </span></span>
<span><span class="co">#&gt; t                     11                    heightAboveGround     2000                 </span></span>
<span><span class="co">#&gt; t                     11                    heightAboveGround     2500                 </span></span>
<span><span class="co">#&gt; t                     11                    heightAboveGround     3000                 </span></span>
<span><span class="co">#&gt; pres                  1                     heightAboveGround     20                   </span></span>
<span><span class="co">#&gt; pres                  1                     heightAboveGround     50                   </span></span>
<span><span class="co">#&gt; pres                  1                     heightAboveGround     100                  </span></span>
<span><span class="co">#&gt; pres                  1                     heightAboveGround     250                  </span></span>
<span><span class="co">#&gt; pres                  1                     heightAboveGround     500                  </span></span>
<span><span class="co">#&gt; pres                  1                     heightAboveGround     750                  </span></span>
<span><span class="co">#&gt; pres                  1                     heightAboveGround     1000                 </span></span>
<span><span class="co">#&gt; pres                  1                     heightAboveGround     1250                 </span></span>
<span><span class="co">#&gt; pres                  1                     heightAboveGround     1500                 </span></span>
<span><span class="co">#&gt; pres                  1                     heightAboveGround     2000                 </span></span>
<span><span class="co">#&gt; pres                  1                     heightAboveGround     2500                 </span></span>
<span><span class="co">#&gt; pres                  1                     heightAboveGround     3000                 </span></span>
<span><span class="co">#&gt; pres                  1                     heightAboveGround     0                    </span></span>
<span><span class="co">#&gt; u                     33                    potentialVorticity    1500                 </span></span>
<span><span class="co">#&gt; u                     33                    potentialVorticity    2000                 </span></span>
<span><span class="co">#&gt; v                     34                    potentialVorticity    1500                 </span></span>
<span><span class="co">#&gt; v                     34                    potentialVorticity    2000                 </span></span>
<span><span class="co">#&gt; z                     6                     potentialVorticity    1500                 </span></span>
<span><span class="co">#&gt; z                     6                     potentialVorticity    2000                 </span></span>
<span><span class="co">#&gt; t                     11                    hybrid                65                   </span></span>
<span><span class="co">#&gt; ws                    32                    heightAboveGround     10                   </span></span>
<span><span class="co">#&gt; tp                    61                    heightAboveGround     0</span></span></code></pre>
<div class="section level3">
<h3 id="setting-the-shortname">Setting the shortName<a class="anchor" aria-label="anchor" href="#setting-the-shortname"></a>
</h3>
<p>If we take for example the grib message with shortName “tp”, we can
read this without problem using the harp parameter “Pcp”:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span><span class="va">grib_file</span>, <span class="st">"Pcp"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/grib/AROME_Arctic/2018/07/10/00/fc2018071000+006grib_fp</span></span></code></pre>
<pre><code><span><span class="co">#&gt; eidb : TP Total precipitation kg m**-2 </span></span>
<span><span class="co">#&gt; Time:</span></span>
<span><span class="co">#&gt;  2018/07/10 00:00</span></span>
<span><span class="co">#&gt; Domain summary:</span></span>
<span><span class="co">#&gt; 100 x 100 domain</span></span>
<span><span class="co">#&gt; Projection summary:</span></span>
<span><span class="co">#&gt; proj= lcc </span></span>
<span><span class="co">#&gt; NE = ( 23.31109 , 78.2607 )</span></span>
<span><span class="co">#&gt; SW = ( 8.042 , 77.968 )</span></span>
<span><span class="co">#&gt; Data summary:</span></span>
<span><span class="co">#&gt; 0 0.2287102 0.5398808 1.363777 1.41673 32.08449</span></span></code></pre>
<p>However, what if for some reason we wanted to use “Precip” instead of
“Pcp” for the parameter name. Then <code><a href="../reference/read_grid.html">read_grid()</a></code> will not
know which <em>shortName</em> to search for, so will attempt to find a
message with <em>shortName</em> = “precip”, and won’t be able to find
anything. Note it also uses <em>levelType</em> = 255 and <em>level</em>
= -999. This means that if it does find messages with with
<em>shortName</em> = “precip”, it will ignore the type of level and read
messages for all levels.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span><span class="va">grib_file</span>, <span class="st">"Precip"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Warning: Parameter "Precip" (shortName: "Precip", typeOfLevel: "unknown" for</span></span>
<span><span class="co">#&gt; level(s) -999) not found in grib file.</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Error: None of the requested data could be read from grib file: /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/grib/AROME_Arctic/2018/07/10/00/fc2018071000+006grib_fp</span></span></code></pre>
<p>We can then use <code><a href="../reference/grib_opts.html">grib_opts()</a></code> with the argument
<code>param_find</code> to force it to look for the <em>shortName</em>
“tp” instead. <code>param_find</code> must be a named list with the name
being the same as the parameter that is requested, and the elements can
be set using a <code>use_grib_*()</code> function, which are listed in
the help for <code><a href="../reference/grib_opts.html">grib_opts()</a></code>. To set the grib
<em>shortName</em> to look for, we use the
<code><a href="../reference/grib_opts.html">use_grib_shortName()</a></code> function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">grib_file</span>,</span>
<span>  <span class="st">"Precip"</span>,</span>
<span>  file_format_opts <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">grib_opts</a></span><span class="op">(</span></span>
<span>    param_find <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Precip <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">use_grib_shortName</a></span><span class="op">(</span><span class="st">"tp"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/grib/AROME_Arctic/2018/07/10/00/fc2018071000+006grib_fp</span></span></code></pre>
<pre><code><span><span class="co">#&gt; eidb : TP Total precipitation kg m**-2 </span></span>
<span><span class="co">#&gt; Time:</span></span>
<span><span class="co">#&gt;  2018/07/10 00:00</span></span>
<span><span class="co">#&gt; Domain summary:</span></span>
<span><span class="co">#&gt; 100 x 100 domain</span></span>
<span><span class="co">#&gt; Projection summary:</span></span>
<span><span class="co">#&gt; proj= lcc </span></span>
<span><span class="co">#&gt; NE = ( 23.31109 , 78.2607 )</span></span>
<span><span class="co">#&gt; SW = ( 8.042 , 77.968 )</span></span>
<span><span class="co">#&gt; Data summary:</span></span>
<span><span class="co">#&gt; 0 0.2287102 0.5398808 1.363777 1.41673 32.08449</span></span></code></pre>
<p>We can also read more than one variable in this way - for example,
let’s say we want to read 2m temperature, precipitation and total cloud
cover - we will stick with the harp name, “T2m”, for 2m temperature but
use different names for precipitation (Precip, <em>shortName</em> =
“tp”) and total cloud cover (Cloud, <em>shortName</em> = “tcc”).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">grib_file</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cloud"</span>, <span class="st">"T2m"</span>, <span class="st">"Precip"</span><span class="op">)</span>,</span>
<span>  file_format_opts <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">grib_opts</a></span><span class="op">(</span></span>
<span>    param_find <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      Precip <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">use_grib_shortName</a></span><span class="op">(</span><span class="st">"tp"</span><span class="op">)</span>,</span>
<span>      Cloud  <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">use_grib_shortName</a></span><span class="op">(</span><span class="st">"tcc"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/grib/AROME_Arctic/2018/07/10/00/fc2018071000+006grib_fp</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;">&lt;harp_geolist[3]&gt;</span></span></span>
<span><span class="co"><span style="color: #949494;">#&gt; </span>[[1]] &lt;numeric geofield [100 x 100] Min = 0.000 Max = 1.000 Mean = 0.968&gt;</span></span>
<span><span class="co">#&gt; [[2]] &lt;numeric geofield [100 x 100] Min = 0.000 Max = 32.084 Mean = 1.364&gt;</span></span>
<span><span class="co">#&gt; [[3]] &lt;numeric geofield [100 x 100] Min = 270.902 Max = 279.981 Mean = 276.333&gt;</span></span></code></pre>
<p>And if we set the output of <code><a href="../reference/read_grid.html">read_grid()</a></code> to be a data
frame, we can see that the modified parameter names have been used.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">grib_file</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cloud"</span>, <span class="st">"T2m"</span>, <span class="st">"Precip"</span><span class="op">)</span>,</span>
<span>  file_format_opts <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">grib_opts</a></span><span class="op">(</span></span>
<span>    param_find <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      Precip <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">use_grib_shortName</a></span><span class="op">(</span><span class="st">"tp"</span><span class="op">)</span>,</span>
<span>      Cloud  <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">use_grib_shortName</a></span><span class="op">(</span><span class="st">"tcc"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>, </span>
<span>  data_frame <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"dttm"</span><span class="op">)</span>, <span class="op">-</span><span class="va">members</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/grib/AROME_Arctic/2018/07/10/00/fc2018071000+006grib_fp</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;   lead_time step_range parameter level_type level units    gridded_data</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;geolist&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         6 6          Cloud     height         0 fraction  <span style="color: #949494;">[100 × 100]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         6 0-6        Precip    height         0 kg/m^2    <span style="color: #949494;">[100 × 100]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>         6 6          T2m       height         2 K         <span style="color: #949494;">[100 × 100]</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="dealing-with-an-unknown-shortname">Dealing with an unknown shortName<a class="anchor" aria-label="anchor" href="#dealing-with-an-unknown-shortname"></a>
</h3>
<p>In some cases the grib lookup table that is used may be a local
version that is not included with ecCodes. In this case you would need
to use another grib key to locate the correct message. Typically this
would be <em>indicatorOfParameter</em> for grib edition 1, or
<em>paramId</em> for grib edition 2. Looking back to the output of
<code>grib_ls</code> above, we can see that the message for total
precipitation (<em>shortName</em> = “tp”) has
<em>indicatorOfParameter</em> = 61, and that for 10m wind speed
(<em>shortName</em> = “ws”) has <em>indicatorOfParameter</em> = 32. We
can therefore use these to extract the data from the file by using
<code>use_grib_indicatorOfParameter</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">grib_file</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"total_precipitation"</span>, <span class="st">"wind_speed"</span><span class="op">)</span>,</span>
<span>  file_format_opts <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">grib_opts</a></span><span class="op">(</span></span>
<span>    param_find <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      total_precipitation <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">use_grib_indicatorOfParameter</a></span><span class="op">(</span><span class="fl">61</span><span class="op">)</span>,</span>
<span>      wind_speed          <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">use_grib_indicatorOfParameter</a></span><span class="op">(</span><span class="fl">32</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/grib/AROME_Arctic/2018/07/10/00/fc2018071000+006grib_fp</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;">&lt;harp_geolist[2]&gt;</span></span></span>
<span><span class="co"><span style="color: #949494;">#&gt; </span>[[1]] &lt;numeric geofield [100 x 100] Min = 0.000 Max = 32.084 Mean = 1.364&gt;</span></span>
<span><span class="co">#&gt; [[2]] &lt;numeric geofield [100 x 100] Min = 0.801 Max = 21.458 Mean = 9.962&gt;</span></span></code></pre>
<p>In practical situations, where the grib <em>shortName</em> is not
known, it is the user’s responsibility to know which
<em>indicatorOfParameter</em> or <em>paramId</em> to use.</p>
</div>
<div class="section level3">
<h3 id="reading-data-from-specific-level-types">Reading data from specific level types<a class="anchor" aria-label="anchor" href="#reading-data-from-specific-level-types"></a>
</h3>
<p>In our example data file, some data exist on potential vorticity
levels. {harpIO} does not know how to read these data, but we can use
the <code>level_find</code> argument of <code><a href="../reference/grib_opts.html">grib_opts()</a></code> to
select the correct type of level. <code>level_find</code> works in the
same way as <code>param_find</code> in that it requires a named list and
a <code>use_grib_*()</code> function to set the correct grib keys. Here,
the <em>typeOfLevel</em> key has a value of “potentialVorticity”, so we
can read the geopotential (Z), wind speed in the x direction of the
model grid (U), and wind speed in the y direction of the model grid (V)
by setting the <em>typeOfLevel</em> key to “potentialVorticity”. Z, U, V
are parameters that {harpIO} knows, so we don’t need to worry about
<code>param_find</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">grib_file</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"U"</span>, <span class="st">"V"</span>, <span class="st">"Z"</span><span class="op">)</span>,</span>
<span>  file_format_opts <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">grib_opts</a></span><span class="op">(</span></span>
<span>    level_find <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      U <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">use_grib_typeOfLevel</a></span><span class="op">(</span><span class="st">"potentialVorticity"</span><span class="op">)</span>,</span>
<span>      V <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">use_grib_typeOfLevel</a></span><span class="op">(</span><span class="st">"potentialVorticity"</span><span class="op">)</span>,</span>
<span>      Z <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">use_grib_typeOfLevel</a></span><span class="op">(</span><span class="st">"potentialVorticity"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>, </span>
<span>  data_frame <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"dttm"</span><span class="op">)</span>, <span class="op">-</span><span class="va">members</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/grib/AROME_Arctic/2018/07/10/00/fc2018071000+006grib_fp</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   lead_time step_range parameter level_type level units   gridded_data</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;geolist&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         6 6          U         unknown     <span style="text-decoration: underline;">1</span>500 m/s      <span style="color: #949494;">[100 × 100]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         6 6          U         unknown     <span style="text-decoration: underline;">2</span>000 m/s      <span style="color: #949494;">[100 × 100]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>         6 6          V         unknown     <span style="text-decoration: underline;">1</span>500 m/s      <span style="color: #949494;">[100 × 100]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>         6 6          V         unknown     <span style="text-decoration: underline;">2</span>000 m/s      <span style="color: #949494;">[100 × 100]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>         6 6          Z         unknown     <span style="text-decoration: underline;">1</span>500 m^2/s^2  <span style="color: #949494;">[100 × 100]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>         6 6          Z         unknown     <span style="text-decoration: underline;">2</span>000 m^2/s^2  <span style="color: #949494;">[100 × 100]</span></span></span></code></pre>
<p>By default, all levels are read, but we can use the second argument
of <code>use_grib_typeOfLevel</code> to set the levels to read:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">grib_file</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"U"</span>, <span class="st">"V"</span>, <span class="st">"Z"</span><span class="op">)</span>,</span>
<span>  file_format_opts <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">grib_opts</a></span><span class="op">(</span></span>
<span>    level_find <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      U <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">use_grib_typeOfLevel</a></span><span class="op">(</span><span class="st">"potentialVorticity"</span>, <span class="fl">1500</span><span class="op">)</span>,</span>
<span>      V <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">use_grib_typeOfLevel</a></span><span class="op">(</span><span class="st">"potentialVorticity"</span>, <span class="fl">3000</span><span class="op">)</span>,</span>
<span>      Z <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">use_grib_typeOfLevel</a></span><span class="op">(</span><span class="st">"potentialVorticity"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">3000</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>, </span>
<span>  data_frame <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"dttm"</span><span class="op">)</span>, <span class="op">-</span><span class="va">members</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/grib/AROME_Arctic/2018/07/10/00/fc2018071000+006grib_fp</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Warning: Parameter "V" (shortName: "v", typeOfLevel: "potentialVorticity" for</span></span>
<span><span class="co">#&gt; level(s) 3000) not found in grib file.</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 7</span></span></span>
<span><span class="co">#&gt;   lead_time step_range parameter level_type level units   gridded_data</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;geolist&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         6 6          U         unknown     <span style="text-decoration: underline;">1</span>500 m/s      <span style="color: #949494;">[100 × 100]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         6 6          Z         unknown     <span style="text-decoration: underline;">2</span>000 m^2/s^2  <span style="color: #949494;">[100 × 100]</span></span></span></code></pre>
<p>Note that currently a warning is only given if no levels are found.
If more than one level is asked for, but at least one is found the
function is silent about the missing levels.</p>
</div>
<div class="section level3">
<h3 id="reading-specific-levels">Reading specific levels<a class="anchor" aria-label="anchor" href="#reading-specific-levels"></a>
</h3>
<p>Currently <code><a href="../reference/read_grid.html">read_grid()</a></code> and <code><a href="../reference/read_forecast.html">read_forecast()</a></code>
can either read one or all vertical levels from files. To read a small
selection of levels from a grib file, the <code>level_find</code>
argument to <code><a href="../reference/grib_opts.html">grib_opts()</a></code> can be used conjunction with
<code><a href="../reference/grib_opts.html">use_grib_pressure()</a></code>, <code><a href="../reference/grib_opts.html">use_grib_model()</a></code> and
<code><a href="../reference/grib_opts.html">use_grib_heightAboveGround()</a></code> to read from specific
pressure, model (hybrid), or height levels. Our example data contain
data on a range of pressure levels, so if we want, for example,
temperature at 850-, 500- and 200 hPa, we would do the following:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">grib_file</span>, </span>
<span>  <span class="st">"T"</span>,</span>
<span>  file_format_opts <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">grib_opts</a></span><span class="op">(</span></span>
<span>    level_find <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      T <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">use_grib_pressure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">850</span>, <span class="fl">500</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data_frame <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="op">-</span><span class="va">members</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/grib/AROME_Arctic/2018/07/10/00/fc2018071000+006grib_fp</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 9</span></span></span>
<span><span class="co">#&gt;   fcst_dttm           valid_dttm          lead_time step_range parameter</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2018-07-10 <span style="color: #949494;">00:00:00</span> 2018-07-10 <span style="color: #949494;">06:00:00</span>         6 6          T        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2018-07-10 <span style="color: #949494;">00:00:00</span> 2018-07-10 <span style="color: #949494;">06:00:00</span>         6 6          T        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2018-07-10 <span style="color: #949494;">00:00:00</span> 2018-07-10 <span style="color: #949494;">06:00:00</span>         6 6          T        </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: level_type &lt;chr&gt;, level &lt;int&gt;, units &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   gridded_data &lt;geolist&gt;</span></span></span></code></pre>
<p>Similarly, to read temperature at 500-, 1000- and 1500m above the
ground we would do the following:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">grib_file</span>, </span>
<span>  <span class="st">"T"</span>,</span>
<span>  file_format_opts <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">grib_opts</a></span><span class="op">(</span></span>
<span>    level_find <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      T <span class="op">=</span> <span class="fu"><a href="../reference/grib_opts.html">use_grib_heightAboveGround</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">1500</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data_frame <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="op">-</span><span class="va">members</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/grib/AROME_Arctic/2018/07/10/00/fc2018071000+006grib_fp</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 9</span></span></span>
<span><span class="co">#&gt;   fcst_dttm           valid_dttm          lead_time step_range parameter</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2018-07-10 <span style="color: #949494;">00:00:00</span> 2018-07-10 <span style="color: #949494;">06:00:00</span>         6 6          T        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2018-07-10 <span style="color: #949494;">00:00:00</span> 2018-07-10 <span style="color: #949494;">06:00:00</span>         6 6          T        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2018-07-10 <span style="color: #949494;">00:00:00</span> 2018-07-10 <span style="color: #949494;">06:00:00</span>         6 6          T        </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: level_type &lt;chr&gt;, level &lt;int&gt;, units &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   gridded_data &lt;geolist&gt;</span></span></span></code></pre>
<p>It should be emphasised that <strong>no interpolation is
done</strong>. i.e. you can only use <code>level_find</code> to select
vertical levels that exist in the file.</p>
</div>
</div>
<div class="section level2">
<h2 id="netcdf-files">Netcdf files<a class="anchor" aria-label="anchor" href="#netcdf-files"></a>
</h2>
<p>Netcdf files are becoming increasingly used in meteorology and
climatology. Each variable in a netcdf file is stored as an array that
can be subsetted. Each array in the file has attributes and dimensions
that describe the variable. In order to read data from netcdf files
using {harpIO} it is important that you know something about the
contents of the files so that the correct variables can be read and the
correct subsets taken. This is done by passing a list generated by the
<code><a href="../reference/netcdf_opts.html">netcdf_opts()</a></code> function to <code><a href="../reference/read_forecast.html">read_forecast()</a></code> or
<code><a href="../reference/read_grid.html">read_grid()</a></code> via the <code>file_format_opts</code> argument.
<code><a href="../reference/netcdf_opts.html">netcdf_opts()</a></code> generates a list that has names for the
dimensions of an array and either where to find the geographic
projection information in the file, or the projection information as a
<a href="https://proj.org/operations/projections/index.html" class="external-link">proj4
string</a>, and whether any of the dimensions are reversed.</p>
<p>We can use a netcdf file from the {harpData} package to show how
<code><a href="../reference/netcdf_opts.html">netcdf_opts()</a></code> works.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nc_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"netcdf/AAEPS/fc2018071000.nc"</span>, </span>
<span>  package <span class="op">=</span> <span class="st">"harpData"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then we can open a connection to the file using the {ncdf4} package
to get a summary of the contents of the file.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cirrus.ucsd.edu/~pierce/ncdf/" class="external-link">ncdf4</a></span><span class="op">)</span></span>
<span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/nc_open.html" class="external-link">nc_open</a></span><span class="op">(</span><span class="va">nc_file</span><span class="op">)</span></span>
<span><span class="va">nc</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; File /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/netcdf/AAEPS/fc2018071000.nc (NC_FORMAT_NETCDF4_CLASSIC):</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      13 variables (excluding dimension variables):</span></span>
<span><span class="co">#&gt;         double forecast_reference_time[]   (Contiguous storage)  </span></span>
<span><span class="co">#&gt;             units: seconds since 1970-01-01 00:00:00 +00:00</span></span>
<span><span class="co">#&gt;             standard_name: forecast_reference_time</span></span>
<span><span class="co">#&gt;         double p0[]   (Contiguous storage)  </span></span>
<span><span class="co">#&gt;             units: Pa</span></span>
<span><span class="co">#&gt;         double ap[hybrid]   (Chunking: [65])  (Compression: shuffle,level 3)</span></span>
<span><span class="co">#&gt;             units: Pa</span></span>
<span><span class="co">#&gt;         double b[hybrid]   (Chunking: [65])  (Compression: shuffle,level 3)</span></span>
<span><span class="co">#&gt;             units: 1</span></span>
<span><span class="co">#&gt;         int projection_lambert[]   (Contiguous storage)  </span></span>
<span><span class="co">#&gt;             grid_mapping_name: lambert_conformal_conic</span></span>
<span><span class="co">#&gt;             standard_parallel: 77.5</span></span>
<span><span class="co">#&gt;              standard_parallel: 77.5</span></span>
<span><span class="co">#&gt;             longitude_of_central_meridian: -25</span></span>
<span><span class="co">#&gt;             latitude_of_projection_origin: 77.5</span></span>
<span><span class="co">#&gt;             earth_radius: 6371000</span></span>
<span><span class="co">#&gt;             proj4: +proj=lcc +lat_0=77.5 +lon_0=-25 +lat_1=77.5 +lat_2=77.5 +no_defs +R=6.371e+06</span></span>
<span><span class="co">#&gt;         double longitude[x,y]   (Chunking: [100,100])  (Compression: shuffle,level 3)</span></span>
<span><span class="co">#&gt;             units: degree_east</span></span>
<span><span class="co">#&gt;             long_name: longitude</span></span>
<span><span class="co">#&gt;             standard_name: longitude</span></span>
<span><span class="co">#&gt;         double latitude[x,y]   (Chunking: [100,100])  (Compression: shuffle,level 3)</span></span>
<span><span class="co">#&gt;             units: degree_north</span></span>
<span><span class="co">#&gt;             long_name: latitude</span></span>
<span><span class="co">#&gt;             standard_name: latitude</span></span>
<span><span class="co">#&gt;         int specific_humidity_ml[x,y,ensemble_member,hybrid,time]   (Chunking: [100,100,5,24,1])  (Compression: shuffle,level 3)</span></span>
<span><span class="co">#&gt;             _FillValue: -2147483647</span></span>
<span><span class="co">#&gt;             long_name: Specific humidity model levels</span></span>
<span><span class="co">#&gt;             standard_name: specific_humidity</span></span>
<span><span class="co">#&gt;             units: kg/kg</span></span>
<span><span class="co">#&gt;             grid_mapping: projection_lambert</span></span>
<span><span class="co">#&gt;             coordinates: longitude latitude</span></span>
<span><span class="co">#&gt;             scale_factor: 1e-07</span></span>
<span><span class="co">#&gt;         float air_temperature_2m[x,y,ensemble_member,height1,time]   (Chunking: [100,100,5,1,1])  (Compression: shuffle,level 3)</span></span>
<span><span class="co">#&gt;             _FillValue: 9.96920996838687e+36</span></span>
<span><span class="co">#&gt;             long_name: Screen level temperature (T2M)</span></span>
<span><span class="co">#&gt;             standard_name: air_temperature</span></span>
<span><span class="co">#&gt;             units: K</span></span>
<span><span class="co">#&gt;             grid_mapping: projection_lambert</span></span>
<span><span class="co">#&gt;             coordinates: longitude latitude</span></span>
<span><span class="co">#&gt;         float specific_humidity_2m[x,y,ensemble_member,height1,time]   (Chunking: [100,100,5,1,1])  (Compression: shuffle,level 3)</span></span>
<span><span class="co">#&gt;             _FillValue: 9.96920996838687e+36</span></span>
<span><span class="co">#&gt;             long_name: Screen level specific humidity</span></span>
<span><span class="co">#&gt;             standard_name: specific_humidity</span></span>
<span><span class="co">#&gt;             units: kg/kg</span></span>
<span><span class="co">#&gt;             grid_mapping: projection_lambert</span></span>
<span><span class="co">#&gt;             coordinates: longitude latitude</span></span>
<span><span class="co">#&gt;         int air_temperature_ml[x,y,ensemble_member,hybrid,time]   (Chunking: [100,100,5,24,1])  (Compression: shuffle,level 3)</span></span>
<span><span class="co">#&gt;             _FillValue: -2147483647</span></span>
<span><span class="co">#&gt;             long_name: Air temperature model levels</span></span>
<span><span class="co">#&gt;             standard_name: air_temperature</span></span>
<span><span class="co">#&gt;             units: K</span></span>
<span><span class="co">#&gt;             grid_mapping: projection_lambert</span></span>
<span><span class="co">#&gt;             coordinates: longitude latitude</span></span>
<span><span class="co">#&gt;             scale_factor: 0.001</span></span>
<span><span class="co">#&gt;         float surface_air_pressure[x,y,ensemble_member,height0,time]   (Chunking: [100,100,5,1,1])  (Compression: shuffle,level 3)</span></span>
<span><span class="co">#&gt;             _FillValue: 9.96920996838687e+36</span></span>
<span><span class="co">#&gt;             long_name: Surface air pressure</span></span>
<span><span class="co">#&gt;             standard_name: surface_air_pressure</span></span>
<span><span class="co">#&gt;             units: Pa</span></span>
<span><span class="co">#&gt;             grid_mapping: projection_lambert</span></span>
<span><span class="co">#&gt;             coordinates: longitude latitude</span></span>
<span><span class="co">#&gt;         float surface_geopotential[x,y,ensemble_member,height0,time]   (Chunking: [100,100,5,1,1])  (Compression: shuffle,level 3)</span></span>
<span><span class="co">#&gt;             _FillValue: 9.96920996838687e+36</span></span>
<span><span class="co">#&gt;             long_name: Surface geopotential (fis)</span></span>
<span><span class="co">#&gt;             standard_name: surface_geopotential</span></span>
<span><span class="co">#&gt;             units: m^2/s^2</span></span>
<span><span class="co">#&gt;             grid_mapping: projection_lambert</span></span>
<span><span class="co">#&gt;             coordinates: longitude latitude</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      7 dimensions:</span></span>
<span><span class="co">#&gt;         time  Size:5   *** is unlimited *** </span></span>
<span><span class="co">#&gt;             long_name: time</span></span>
<span><span class="co">#&gt;             standard_name: time</span></span>
<span><span class="co">#&gt;             units: seconds since 1970-01-01 00:00:00 +00:00</span></span>
<span><span class="co">#&gt;         ensemble_member  Size:5 </span></span>
<span><span class="co">#&gt;             long_name: ensemble run number</span></span>
<span><span class="co">#&gt;             standard_name: realization</span></span>
<span><span class="co">#&gt;             flag_values: 0</span></span>
<span><span class="co">#&gt;              flag_values: 1</span></span>
<span><span class="co">#&gt;              flag_values: 2</span></span>
<span><span class="co">#&gt;              flag_values: 3</span></span>
<span><span class="co">#&gt;              flag_values: 4</span></span>
<span><span class="co">#&gt;              flag_values: 5</span></span>
<span><span class="co">#&gt;              flag_values: 6</span></span>
<span><span class="co">#&gt;              flag_values: 7</span></span>
<span><span class="co">#&gt;              flag_values: 8</span></span>
<span><span class="co">#&gt;              flag_values: 9</span></span>
<span><span class="co">#&gt;              flag_values: 10</span></span>
<span><span class="co">#&gt;             flag_meanings: mbr000 mbr001 mbr002 mbr003 mbr004 mbr005 mbr006 mbr007 mbr008 mbr009 mbr010</span></span>
<span><span class="co">#&gt;         height0  Size:1 </span></span>
<span><span class="co">#&gt;             description: height above ground</span></span>
<span><span class="co">#&gt;             long_name: height</span></span>
<span><span class="co">#&gt;             positive: up</span></span>
<span><span class="co">#&gt;             units: m</span></span>
<span><span class="co">#&gt;         height1  Size:1 </span></span>
<span><span class="co">#&gt;             description: height above ground</span></span>
<span><span class="co">#&gt;             long_name: height</span></span>
<span><span class="co">#&gt;             positive: up</span></span>
<span><span class="co">#&gt;             units: m</span></span>
<span><span class="co">#&gt;         hybrid  Size:65 </span></span>
<span><span class="co">#&gt;             standard_name: atmosphere_hybrid_sigma_pressure_coordinate</span></span>
<span><span class="co">#&gt;             formula: p(n,k,j,i) = ap(k) + b(k)*ps(n,j,i)</span></span>
<span><span class="co">#&gt;             formula_terms: ap: ap b: b ps: surface_air_pressure p0: p0</span></span>
<span><span class="co">#&gt;             long_name: atmosphere_hybrid_sigma_pressure_coordinate</span></span>
<span><span class="co">#&gt;             positive: down</span></span>
<span><span class="co">#&gt;         x  Size:100 </span></span>
<span><span class="co">#&gt;             long_name: x-coordinate in Cartesian system</span></span>
<span><span class="co">#&gt;             standard_name: projection_x_coordinate</span></span>
<span><span class="co">#&gt;             units: m</span></span>
<span><span class="co">#&gt;         y  Size:100 </span></span>
<span><span class="co">#&gt;             long_name: y-coordinate in Cartesian system</span></span>
<span><span class="co">#&gt;             standard_name: projection_y_coordinate</span></span>
<span><span class="co">#&gt;             units: m</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     16 global attributes:</span></span>
<span><span class="co">#&gt;         Conventions: CF-1.6</span></span>
<span><span class="co">#&gt;         institution: Norwegian Meteorological Institute, MET Norway</span></span>
<span><span class="co">#&gt;         creator_url: met.no</span></span>
<span><span class="co">#&gt;         summary: MEPS (MetCoOp-Ensemble Prediction System) is a convection-permitting atmosphere ensemble model covering Scandinavia and the Nordic Seas. It has horizontal resolution of 2.5 km, has 65 vertical levels and 10 members. MEPS is ran four times daily (00,06,12,18) with three-hourly cycling for data assimilation. Member 0 and 1 are ran up to 66 hours, the rest up to 48 hours. Boundary data is from ECMWF, and initial perturbations are based on the SLAF method. Model code based on HARMONIE cy40h1.1</span></span>
<span><span class="co">#&gt;         source: MEPS 2.5km</span></span>
<span><span class="co">#&gt;         title: MEPS 2.5km</span></span>
<span><span class="co">#&gt;         min_time: 2018-07-10 00:00:00Z</span></span>
<span><span class="co">#&gt;         max_time: 2018-07-12</span></span>
<span><span class="co">#&gt;         geospatial_lat_min: 51.0</span></span>
<span><span class="co">#&gt;         geospatial_lat_max: 88.0</span></span>
<span><span class="co">#&gt;         geospatial_lon_min: -20.0</span></span>
<span><span class="co">#&gt;         geospatial_lon_max: 80.0</span></span>
<span><span class="co">#&gt;         references: unknown</span></span>
<span><span class="co">#&gt;         license: https://www.met.no/en/free-meteorological-data/Licensing-and-crediting</span></span>
<span><span class="co">#&gt;         comment: none</span></span>
<span><span class="co">#&gt;         history: 2019-07-17 creation by fimex</span></span></code></pre>
<p>From the above you see the variables, their attributes, the
dimensions of the variables and some global attributes. We can use this
information to set the correct information using
<code><a href="../reference/netcdf_opts.html">netcdf_opts()</a></code> when we want to read data using
<code><a href="../reference/read_forecast.html">read_forecast()</a></code>, or <code><a href="../reference/read_grid.html">read_grid()</a></code>. For these
examples we will use <code><a href="../reference/read_grid.html">read_grid()</a></code>, but the same principles
apply for <code><a href="../reference/read_forecast.html">read_forecast()</a></code>.</p>
<p>It is important to close the connection to a netcdf file when we are
finished with it (this is taken care of for us when we use
<code><a href="../reference/read_forecast.html">read_forecast()</a></code> and <code><a href="../reference/read_grid.html">read_grid()</a></code>).</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/nc_close.html" class="external-link">nc_close</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span></span></code></pre></div>
<p>Let’s take a look at some of the default values for
<code><a href="../reference/netcdf_opts.html">netcdf_opts()</a></code></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/netcdf_opts.html">netcdf_opts</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; $options_set</span></span>
<span><span class="co">#&gt; [1] "none"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $param_find</span></span>
<span><span class="co">#&gt; list()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $proj4_var</span></span>
<span><span class="co">#&gt; [1] "projection_lambert"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $proj4_att</span></span>
<span><span class="co">#&gt; [1] "proj4"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $proj4</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $x_dim</span></span>
<span><span class="co">#&gt; [1] "x"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $y_dim</span></span>
<span><span class="co">#&gt; [1] "y"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $lon_var</span></span>
<span><span class="co">#&gt; [1] "longitude"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $lat_var</span></span>
<span><span class="co">#&gt; [1] "latitude"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $x_rev</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $y_rev</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dx</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dy</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $z_var</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $member_var</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $time_var</span></span>
<span><span class="co">#&gt; [1] "time"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ref_time_var</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $force_param_name</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre>
<div class="section level3">
<h3 id="projection-information">Projection information<a class="anchor" aria-label="anchor" href="#projection-information"></a>
</h3>
<p>There are 3 elements in the list that begin with <code>proj4_</code>.
These are to control where the projection information is obtained.</p>
<ul>
<li>
<em>proj4_var</em> is the name of the variable in the netcdf file
that holds the proj4 string.</li>
<li>
<em>proj4_att</em> is the name of the attribute of
<em>proj4_var</em> that has the proj4 string. If set to
<code>NULL</code>, an attempt is made to read the proj4 string directly
from <em>proj4_var</em>
</li>
<li>
<em>proj4</em> is where you can set the proj4 string directly rather
than attempt to read it from the file. If <em>proj4</em> is not
<code>NULL</code>, <em>proj4_var</em> and <em>proj4_att</em> are
ignored.</li>
</ul>
<p>In the summary of our netcdf file above, there is a variable
<code>projection_lambert</code> that has an attribute
<code>proj4</code>, which contains the proj4 string “+proj=lcc
+lat_0=77.5 +lon_0=-25 +lat_1=77.5 +lat_2=77.5 +no_defs +R=6.371e+06”,
so the default values we get from <code><a href="../reference/netcdf_opts.html">netcdf_opts()</a></code> are correct
for this file.</p>
</div>
<div class="section level3">
<h3 id="dimension-names">Dimension names<a class="anchor" aria-label="anchor" href="#dimension-names"></a>
</h3>
<p>The dimension names of variables are set using <em>x_dim</em>,
<em>y_dim</em>, <em>z_var</em>, <em>member_var</em> and
<em>time_var</em>. The reason we need to know the names are that arrays
in netcdf file can be stored in any dimension order, and we may wish to
read only a subset of the array so we need to know which parts of the
dimensions to take. By default, <code><a href="../reference/netcdf_opts.html">netcdf_opts()</a></code> gives us:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_dim</span>      <span class="op">=</span> <span class="st">"x"</span></span>
<span><span class="va">y_dim</span>      <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="va">time_var</span>   <span class="op">=</span> <span class="st">"time"</span></span>
<span><span class="va">z_var</span>      <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="va">member_var</span> <span class="op">=</span> <span class="cn">NA</span></span></code></pre></div>
<p>Since <em>z_var</em> and <em>member_var</em> are NA, the default
means that it is expecting to find variables in the netcdf file with 3
dimensions: “x”, “y” and “time”. If we go back to our example above, and
let’s say we want to read 2m temperature (“air_temperature_2m”, or the
harp parameter “T2m”), we see that air_temperature_2m has 5 dimensions:
<em>x</em>, <em>y</em>, <em>ensemble_member</em>, <em>height1</em> and
<em>time</em>. We therefore need to modify the values of <em>z_var</em>
and <em>member_var</em> using <code><a href="../reference/netcdf_opts.html">netcdf_opts()</a></code>:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_nc_opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/netcdf_opts.html">netcdf_opts</a></span><span class="op">(</span>z_var <span class="op">=</span> <span class="st">"height1"</span>, member_var <span class="op">=</span> <span class="st">"ensemble_member"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="latitude-longitude-and-time">Latitude, longitude and time<a class="anchor" aria-label="anchor" href="#latitude-longitude-and-time"></a>
</h3>
<p>This leaves <em>lon_var</em>, <em>lat_var</em> and
<em>ref_time_var</em>. If the file contains arrays of longitude and
latitude, these are used to geographically orientate the data - if they
are set to <code>NULL</code> an attempt is made to do this using
<em>x_dim</em> and <em>y_dim</em> and the projection information.
<em>ref_time_var</em> is used in forecasts to calculate the lead time.
If set to NA, the lead time is calculated by subtracting the first
element of the time dimension from each subsequent element.</p>
<p>We can now attempt to read some data - firstly without using
<code><a href="../reference/netcdf_opts.html">netcdf_opts()</a></code>:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span><span class="va">nc_file</span>, <span class="st">"T2m"</span>, data_frame <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/netcdf/AAEPS/fc2018071000.nc</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Warning: No 'format_opts' passed for NetCDF file. Using default netcdf_opts()</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Warning: Requested dimensions do not match for 'T2m' in /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/netcdf/AAEPS/fc2018071000.nc.</span></span>
<span><span class="co">#&gt; Requested dimensions: (time, x, y)</span></span>
<span><span class="co">#&gt; Dimensions in file: (ensemble_member, height1, time, x, y).</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Error: Cannot read from netcdf file: /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/netcdf/AAEPS/fc2018071000.nc</span></span></code></pre>
<p>The error tells you what dimension names you have given - in this
case (time, x, y) - the defaults from <code><a href="../reference/netcdf_opts.html">netcdf_opts()</a></code>, and
what dimensions it found in the file: (ensemble_member, height1, time,
x, y). Note that in the warning the dimensions are listed in
alphabetical order, it us up to you to decide which dimension they
should go with.</p>
<p>So, now if we use our modified options to read the file, we should
get a result:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span><span class="va">nc_file</span>, <span class="st">"T2m"</span>, file_format_opts <span class="op">=</span> <span class="va">my_nc_opts</span>, data_frame <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"dttm"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/netcdf/AAEPS/fc2018071000.nc</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 25 × 7</span></span></span>
<span><span class="co">#&gt;    lead_time parameter level_type level units gridded_data   members</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;geolist&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int[1d]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         0 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         0 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         0 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         0 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         0 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         3 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         3 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         3 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>         3 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>         3 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more rows</span></span></span></code></pre>
<p>We can also select specific members and lead times:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">nc_file</span>, </span>
<span>  <span class="st">"T2m"</span>,</span>
<span>  lead_time        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>  members          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, </span>
<span>  file_format_opts <span class="op">=</span> <span class="va">my_nc_opts</span>, </span>
<span>  data_frame       <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"dttm"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/netcdf/AAEPS/fc2018071000.nc</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   lead_time parameter level_type level units gridded_data   members</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;geolist&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int[1d]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         0 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         0 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>         0 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>         3 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>         3 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>         3 T2m       height         2 K      <span style="color: #949494;">[100 × 100]</span>         4</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="options-sets">Options sets<a class="anchor" aria-label="anchor" href="#options-sets"></a>
</h3>
<p>Finally, <code><a href="../reference/netcdf_opts.html">netcdf_opts()</a></code> has a number of default sets of
options that can be set via the <code>options_set</code> argument. These
set the options to known values for some data sources - currently
operational NWP forecasts from MET Norway and WRF (though this isn’t
fully tested). These options are:</p>
<ul>
<li>“met_norway_eps” - EPS forecasts produced by MET Norway,</li>
<li>“met_norway_det” - deterministic forecasts produced by MET
Norway</li>
<li>“met_norway_ifsens” - IFSENS forecasts from ECMWF archived at MET
Norway</li>
<li>“met_norway_ifshires” - IFSHIRES forecasts from ECMWF archived at
MET Norway</li>
<li>“wrf” - WRF forecasts on the WRF “mass” grid</li>
<li>“wrf_u_stagger” - WRF forecasts on the U-staggered grid</li>
<li>“wrf_v_stagger” - WRF forecasts on the V-staggered grid</li>
</ul>
<p>You can, for example, use the “met_norway_det” options set when
reading data from the MET Norway thredds server:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://thredds.met.no/thredds/dodsC/aromearcticarchive/2021/03/01/arome_arctic_extracted_2_5km_20210301T21Z.nc"</span>, </span>
<span>  <span class="st">"T2m"</span>,</span>
<span>  lead_time        <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  file_format      <span class="op">=</span> <span class="st">"netcdf"</span>,</span>
<span>  file_format_opts <span class="op">=</span> <span class="fu"><a href="../reference/netcdf_opts.html">netcdf_opts</a></span><span class="op">(</span><span class="st">"met_norway_det"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading https://thredds.met.no/thredds/dodsC/aromearcticarchive/2021/03/01/arome_arctic_extracted_2_5km_20210301T21Z.nc</span></span></code></pre>
<pre><code><span><span class="co">#&gt;  : T2m K </span></span>
<span><span class="co">#&gt; Time:</span></span>
<span><span class="co">#&gt;  2021/03/01 21:00</span></span>
<span><span class="co">#&gt; Domain summary:</span></span>
<span><span class="co">#&gt; 739 x 949 domain</span></span>
<span><span class="co">#&gt; Projection summary:</span></span>
<span><span class="co">#&gt; proj= lcc </span></span>
<span><span class="co">#&gt; NE = ( 68.83323 , 71.10861 )</span></span>
<span><span class="co">#&gt; SW = ( -17.957 , 69.299 )</span></span>
<span><span class="co">#&gt; Data summary:</span></span>
<span><span class="co">#&gt; 241.2239 257.6566 267.764 264.93 272.1761 279.136</span></span></code></pre>
<p>Note that to download data from an external source we need to
explicitly tell <code><a href="../reference/read_grid.html">read_grid()</a></code> (or
<code><a href="../reference/read_forecast.html">read_forecast()</a></code>) that the file format is “netcdf”. This is
because when the file is on disk an initial scan of the file is done to
try and guess the format, but this is not possible with external files.
For demonstration purposes we could do the same using
<code><a href="../reference/read_forecast.html">read_forecast()</a></code></p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">url</span>      <span class="op">&lt;-</span> <span class="st">"https://thredds.met.no/thredds/dodsC/aromearcticarchive"</span></span>
<span><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">"{YYYY}/{MM}/{DD}/"</span>,</span>
<span>  <span class="st">"{fcst_model}_extracted_2_5km_{YYYY}{MM}{DD}T{HH}Z.nc"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/read_forecast.html">read_forecast</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/harpCore/man/seq_dttm.html" class="external-link">seq_dttm</a></span><span class="op">(</span><span class="fl">2021030100</span>, <span class="fl">2021030118</span>, <span class="st">"6h"</span><span class="op">)</span>,</span>
<span>  fcst_model       <span class="op">=</span> <span class="st">"arome_arctic"</span>,</span>
<span>  parameter        <span class="op">=</span> <span class="st">"T2m"</span>,</span>
<span>  by               <span class="op">=</span> <span class="st">"6h"</span>,</span>
<span>  lead_time        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  file_path        <span class="op">=</span> <span class="va">url</span>,</span>
<span>  file_template    <span class="op">=</span> <span class="va">template</span>,</span>
<span>  file_format      <span class="op">=</span> <span class="st">"netcdf"</span>,</span>
<span>  file_format_opts <span class="op">=</span> <span class="fu"><a href="../reference/netcdf_opts.html">netcdf_opts</a></span><span class="op">(</span><span class="st">"met_norway_det"</span><span class="op">)</span>,</span>
<span>  return_data      <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"level"</span><span class="op">)</span>, <span class="op">-</span><span class="va">fcst_cycle</span> ,<span class="op">-</span><span class="va">valid_dttm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading https://thredds.met.no/thredds/dodsC/aromearcticarchive/2021/03/01/arome_arctic_extracted_2_5km_20210301T00Z.nc</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Reading https://thredds.met.no/thredds/dodsC/aromearcticarchive/2021/03/01/arome_arctic_extracted_2_5km_20210301T06Z.nc</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Reading https://thredds.met.no/thredds/dodsC/aromearcticarchive/2021/03/01/arome_arctic_extracted_2_5km_20210301T12Z.nc</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Reading https://thredds.met.no/thredds/dodsC/aromearcticarchive/2021/03/01/arome_arctic_extracted_2_5km_20210301T18Z.nc</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">::deterministic gridded forecast:: </span><span style="color: #949494;"># A tibble: 16 × 6</span></span></span>
<span><span class="co">#&gt;    fcst_model   fcst_dttm           lead_time parameter units        fcst</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;geolist&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> arome_arctic 2021-03-01 <span style="color: #949494;">00:00:00</span>         0 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> arome_arctic 2021-03-01 <span style="color: #949494;">00:00:00</span>         1 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> arome_arctic 2021-03-01 <span style="color: #949494;">00:00:00</span>         2 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> arome_arctic 2021-03-01 <span style="color: #949494;">00:00:00</span>         3 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> arome_arctic 2021-03-01 <span style="color: #949494;">06:00:00</span>         0 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> arome_arctic 2021-03-01 <span style="color: #949494;">06:00:00</span>         1 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> arome_arctic 2021-03-01 <span style="color: #949494;">06:00:00</span>         2 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> arome_arctic 2021-03-01 <span style="color: #949494;">06:00:00</span>         3 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> arome_arctic 2021-03-01 <span style="color: #949494;">12:00:00</span>         0 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> arome_arctic 2021-03-01 <span style="color: #949494;">12:00:00</span>         1 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> arome_arctic 2021-03-01 <span style="color: #949494;">12:00:00</span>         2 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> arome_arctic 2021-03-01 <span style="color: #949494;">12:00:00</span>         3 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> arome_arctic 2021-03-01 <span style="color: #949494;">18:00:00</span>         0 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> arome_arctic 2021-03-01 <span style="color: #949494;">18:00:00</span>         1 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> arome_arctic 2021-03-01 <span style="color: #949494;">18:00:00</span>         2 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> arome_arctic 2021-03-01 <span style="color: #949494;">18:00:00</span>         3 T2m       K     <span style="color: #949494;">[739 × 949]</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="the-z_var-problem">The <em>z_var</em> problem<a class="anchor" aria-label="anchor" href="#the-z_var-problem"></a>
</h3>
<p>Netcdf files typically contain many variables, and for meteorological
data they can have a range of vertical coordinates - e.g. height,
pressure, model levels etc. So although we have set our options with
<code><a href="../reference/netcdf_opts.html">netcdf_opts()</a></code> we don’t want to set everything for every
variable we wish to read from the file. To address this, the function
<code><a href="../reference/modify_opts.html">modify_opts()</a></code> can be used to change one or more options. If
we try to read “specific_humidity_ml” from our example file with the
netcdf options we currently have, we will get an error as <em>z_var</em>
= “height1”, but for this variable it needs to be “hybrid”:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">nc_file</span>, </span>
<span>  <span class="st">"specific_humidity_ml"</span>, </span>
<span>  lead_time        <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  file_format_opts <span class="op">=</span> <span class="va">my_nc_opts</span>, </span>
<span>  data_frame       <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/netcdf/AAEPS/fc2018071000.nc</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Warning: Requested dimensions do not match for 'specific_humidity_ml' in /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/netcdf/AAEPS/fc2018071000.nc.</span></span>
<span><span class="co">#&gt; Requested dimensions: (ensemble_member, height1, time, x, y)</span></span>
<span><span class="co">#&gt; Dimensions in file: (ensemble_member, hybrid, time, x, y).</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Error: Cannot read from netcdf file: /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/netcdf/AAEPS/fc2018071000.nc</span></span></code></pre>
<p>So, to change <em>z_var</em> to “hybrid” we use
<code><a href="../reference/modify_opts.html">modify_opts()</a></code>:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_grid.html">read_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">nc_file</span>, </span>
<span>  <span class="st">"specific_humidity_ml"</span>,</span>
<span>  lead_time            <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  file_format_opts     <span class="op">=</span> <span class="fu"><a href="../reference/modify_opts.html">modify_opts</a></span><span class="op">(</span><span class="va">my_nc_opts</span>, z_var <span class="op">=</span> <span class="st">"hybrid"</span><span class="op">)</span>,</span>
<span>  data_frame           <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  vertical_coordinate <span class="op">=</span> <span class="st">"model"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"dttm"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/netcdf/AAEPS/fc2018071000.nc</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 325 × 7</span></span></span>
<span><span class="co">#&gt;    lead_time parameter            level_type   level units gridded_data  members</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;geolist&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int[1d&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         3 specific_humidity_ml model      0.009<span style="text-decoration: underline;">87</span> kg/kg  <span style="color: #949494;">[100 × 100]</span>        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         3 specific_humidity_ml model      0.009<span style="text-decoration: underline;">87</span> kg/kg  <span style="color: #949494;">[100 × 100]</span>        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         3 specific_humidity_ml model      0.009<span style="text-decoration: underline;">87</span> kg/kg  <span style="color: #949494;">[100 × 100]</span>        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         3 specific_humidity_ml model      0.009<span style="text-decoration: underline;">87</span> kg/kg  <span style="color: #949494;">[100 × 100]</span>        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         3 specific_humidity_ml model      0.009<span style="text-decoration: underline;">87</span> kg/kg  <span style="color: #949494;">[100 × 100]</span>        4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         3 specific_humidity_ml model      0.029<span style="text-decoration: underline;">6</span>  kg/kg  <span style="color: #949494;">[100 × 100]</span>        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         3 specific_humidity_ml model      0.029<span style="text-decoration: underline;">6</span>  kg/kg  <span style="color: #949494;">[100 × 100]</span>        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         3 specific_humidity_ml model      0.029<span style="text-decoration: underline;">6</span>  kg/kg  <span style="color: #949494;">[100 × 100]</span>        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>         3 specific_humidity_ml model      0.029<span style="text-decoration: underline;">6</span>  kg/kg  <span style="color: #949494;">[100 × 100]</span>        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>         3 specific_humidity_ml model      0.029<span style="text-decoration: underline;">6</span>  kg/kg  <span style="color: #949494;">[100 × 100]</span>        4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 315 more rows</span></span></span></code></pre>
<p>We also have to pass the <code>vertical_coordinate = "model"</code>
to get the correct name in the <code>level_type</code> column in the
data frame of the output.</p>
<p>Note that for variables with a singleton z dimension, any name can be
given for <em>z_var</em> as long as it exists as a dimension in the
file. Furthermore, if there are many different dimensions with names
such as “height0”, “height1”, “height2” etc. the number doesn’t have to
match. This means that you do not have to modify <em>z_var</em> so
much.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Andrew Singleton, Alex Deckmyn.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
