<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="harpIO">
<title>Reading forecast model data • harpIO</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reading forecast model data">
<meta property="og:description" content="harpIO">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">harpIO</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/file_options.html">Options for file formats</a>
    <a class="dropdown-item" href="../articles/read_raw_forecast.html">Reading forecast model data</a>
    <a class="dropdown-item" href="../articles/transformations.html">Transforming forecast model data</a>
    <a class="dropdown-item" href="../articles/write_forecast_data.html">Writing forecast model data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/harphub/harpIO/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Reading forecast model data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/harphub/harpIO/blob/HEAD/vignettes/read_raw_forecast.Rmd" class="external-link"><code>vignettes/read_raw_forecast.Rmd</code></a></small>
      <div class="d-none name"><code>read_raw_forecast.Rmd</code></div>
    </div>

    
    
<style>
body {
text-align: justify;
}
</style>
<p>One of the most important capabilities of harpIO is reading data from
NWP and climate models. The original solution to this task was to have
separate functions for different, but related tasks.
<code><a href="../reference/read_det_interpolate.html">read_det_interpolate()</a></code> and
<code><a href="../reference/read_eps_interpolate.html">read_eps_interpolate()</a></code> to read data from multiple files for
deterministic and ensemble forecasts respectively and to interpolate to
point locations, and <code><a href="../reference/read_grid.html">read_grid()</a></code> to read gridded data from
a single file. This solutions means the user having to learn several
functions, each with their own arguments and output structures. There is
also a lack of flexibility in, for example, reading from both
deterministic and ensemble forecast files at the same time.</p>
<p>We have attempted to streamline this process and to make it as
generic as possible with the <code><a href="../reference/read_forecast.html">read_forecast()</a></code> function,
which we hope results in a more strightforward user interface. The
function is designed to both read the forecast data from multiple files
and, where required, transform the data by interpolation or regridding.
This means that the output is always a class harp_fcst list of data
frames whether the data are at points, a 2d grid or a vertical cross
section.</p>
<p>Furthermore, many arguments as passed as lists generated by
<code>*_opts()</code> functions. This means that you can use tab
autocompletion to get the correct argument names, and can store various
options combinations as variables.</p>
<div class="section level2">
<h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>For all of these examples we will use data provided in the harpData
package, which, if you haven’t done so already, you can install
with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"harphub/harpData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="deterministic-forecasts">Deterministic forecasts<a class="anchor" aria-label="anchor" href="#deterministic-forecasts"></a>
</h2>
<p>The simplest application of <code><a href="../reference/read_forecast.html">read_forecast()</a></code> is to read
deterministic forecasts. At a minimum, the start date, end date, a name
for the forecast model (<code>fcst_model</code>) and the parameter to be
read in are needed as arguments. The data we will use are grib files
from the AROME-Arctic model that come with harpData. By default the
function looks in the current working directory for the files that have
the “vfld” template (see <code><a href="../reference/show_file_templates.html">show_file_templates()</a></code>). Therefore,
we need to also pass the <code>file_path</code> and
<code>file_template</code> arguments. Finally, the default behaviour of
<code><a href="../reference/read_forecast.html">read_forecast()</a></code> is to not return any data - this is because
one of its main roles is to write the data to output files in another
format and the volumes of data involved could easily become too large to
hold in memory - so we should also set
<code>return_data = TRUE</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/harphub/harpIO" class="external-link">harpIO</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Loading required package: harpCore</span></span></code></pre>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'harpCore'</span></span></code></pre>
<pre><code><span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_forecast.html">read_forecast</a></span><span class="op">(</span></span>
<span>  <span class="fl">2018071000</span>,</span>
<span>  <span class="st">"AROME_Arctic"</span>,</span>
<span>  <span class="st">"T2m"</span>,</span>
<span>  file_path     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"grib/AROME_Arctic"</span>, package <span class="op">=</span> <span class="st">"harpData"</span><span class="op">)</span>,</span>
<span>  file_template <span class="op">=</span> <span class="st">"harmonie_grib_fp"</span>,</span>
<span>  return_data   <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">::deterministic gridded forecast:: </span><span style="color: #949494;"># A tibble: 17 × 11</span></span></span>
<span><span class="co">#&gt;    fcst_model   fcst_dttm           lead_time parameter valid_dttm         </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>         0 T2m       2018-07-10 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>         3 T2m       2018-07-10 <span style="color: #949494;">03:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>         6 T2m       2018-07-10 <span style="color: #949494;">06:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>         9 T2m       2018-07-10 <span style="color: #949494;">09:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>        12 T2m       2018-07-10 <span style="color: #949494;">12:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>        15 T2m       2018-07-10 <span style="color: #949494;">15:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>        18 T2m       2018-07-10 <span style="color: #949494;">18:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>        21 T2m       2018-07-10 <span style="color: #949494;">21:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>        24 T2m       2018-07-11 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> AROME_Arctic 2018-07-10 <span style="color: #949494;">00:00:00</span>        27 T2m       2018-07-11 <span style="color: #949494;">03:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: step_range &lt;chr&gt;, level_type &lt;chr&gt;, level &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   units &lt;chr&gt;, fcst_cycle &lt;chr&gt;, fcst &lt;geolist&gt;</span></span></span></code></pre>
<p>The last column in the data frame, named AROME_Arctic_det is the
forecast data, which are stored as geofield objects - these are simply
2d arrays with attributes that describe the projection, time and
parameter information of the data. For all deterministic models the name
of the column is the forecast model name with a suffix “_det”.</p>
</div>
<div class="section level2">
<h2 id="ensemble-forecasts">Ensemble forecasts<a class="anchor" aria-label="anchor" href="#ensemble-forecasts"></a>
</h2>
<p>Reading ensemble forecasts works in exactly the same way. harpData
includes output from the AROME-Arctic ensemble model, AAEPS, for the
same dates as before, but this time stored in a single netcdf file.
Since the data are in a netcdf file, and netcdf files can use many
different dimension names and variable names,
<code><a href="../reference/read_forecast.html">read_forecast()</a></code> needs some information about the structure
of the netcdf file. This structure information is generated with the
function <code><a href="../reference/netcdf_opts.html">netcdf_opts()</a></code>, and since the data come from an EPS
model produced by MET Norway we can use one of the built it options
sets: <code>netcdf_opts(options_set = "met_norway_eps")</code>. All lead
times and ensemble members are in the same file, so if you want to read
all members from the file you don’t have to pass the members as an
argument.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_forecast.html">read_forecast</a></span><span class="op">(</span></span>
<span>  <span class="fl">2018071000</span>,</span>
<span>  <span class="st">"AAEPS"</span>,</span>
<span>  <span class="st">"T2m"</span>,</span>
<span>  file_path        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"netcdf/AAEPS"</span>, package <span class="op">=</span> <span class="st">"harpData"</span><span class="op">)</span>,</span>
<span>  file_template    <span class="op">=</span> <span class="st">"fc{YYYY}{MM}{DD}{HH}.nc"</span>,</span>
<span>  file_format_opts <span class="op">=</span> <span class="fu"><a href="../reference/netcdf_opts.html">netcdf_opts</a></span><span class="op">(</span>options_set <span class="op">=</span> <span class="st">"met_norway_eps"</span><span class="op">)</span>,</span>
<span>  return_data      <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/netcdf/AAEPS/fc2018071000.nc</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Warning: There was 1 warning in `dplyr::mutate()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `forecast_data = purrr::map2(.data[["file_name"]],</span></span>
<span><span class="co">#&gt;   .data[["data"]], safe_read_grid)`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In group 1: `file_name =</span></span>
<span><span class="co">#&gt;   "/home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/netcdf/AAEPS/fc2018071000.nc"`.</span></span>
<span><span class="co">#&gt; Caused by warning:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Lead times: 15h,18h,21h,24h,27h,30h,33h,36h,39h,42h,45h,48h for 'T2m' not found in file.</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">::ensemble gridded forecast:: </span><span style="color: #949494;"># A tibble: 5 × 14</span></span></span>
<span><span class="co">#&gt;   fcst_model fcst_dttm           lead_time parameter valid_dttm         </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> AAEPS      2018-07-10 <span style="color: #949494;">00:00:00</span>         0 T2m       2018-07-10 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> AAEPS      2018-07-10 <span style="color: #949494;">00:00:00</span>         3 T2m       2018-07-10 <span style="color: #949494;">03:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> AAEPS      2018-07-10 <span style="color: #949494;">00:00:00</span>         6 T2m       2018-07-10 <span style="color: #949494;">06:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> AAEPS      2018-07-10 <span style="color: #949494;">00:00:00</span>         9 T2m       2018-07-10 <span style="color: #949494;">09:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> AAEPS      2018-07-10 <span style="color: #949494;">00:00:00</span>        12 T2m       2018-07-10 <span style="color: #949494;">12:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9 more variables: level_type &lt;chr&gt;, level &lt;dbl&gt;, units &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   fcst_cycle &lt;chr&gt;, AAEPS_mbr000 &lt;geolist&gt;, AAEPS_mbr001 &lt;geolist&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   AAEPS_mbr002 &lt;geolist&gt;, AAEPS_mbr003 &lt;geolist&gt;, AAEPS_mbr004 &lt;geolist&gt;</span></span></span></code></pre>
<p>You will see that there is a warning about missing lead times. This
is because the default behaviour is to ask for lead times 0 - 48 hours,
every three hours. The forecast data are in columns with the name of the
forecast model with a suffix “_mbrXXX” where XXX is the member number.
We could also ask for a limited set of lead times and ensemble
members:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_forecast.html">read_forecast</a></span><span class="op">(</span></span>
<span>  <span class="fl">2018071000</span>,</span>
<span>  <span class="st">"AAEPS"</span>,</span>
<span>  <span class="st">"T2m"</span>,</span>
<span>  lead_time        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  members          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  file_path        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"netcdf/AAEPS"</span>, package <span class="op">=</span> <span class="st">"harpData"</span><span class="op">)</span>,</span>
<span>  file_template    <span class="op">=</span> <span class="st">"fc{YYYY}{MM}{DD}{HH}.nc"</span>,</span>
<span>  file_format_opts <span class="op">=</span> <span class="fu"><a href="../reference/netcdf_opts.html">netcdf_opts</a></span><span class="op">(</span>options_set <span class="op">=</span> <span class="st">"met_norway_eps"</span><span class="op">)</span>,</span>
<span>  return_data      <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Reading /home/andrewts/R/x86_64-pc-linux-gnu-library/4.3/harpData/netcdf/AAEPS/fc2018071000.nc</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">::ensemble gridded forecast:: </span><span style="color: #949494;"># A tibble: 3 × 12</span></span></span>
<span><span class="co">#&gt;   fcst_model fcst_dttm           lead_time parameter valid_dttm         </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> AAEPS      2018-07-10 <span style="color: #949494;">00:00:00</span>         0 T2m       2018-07-10 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> AAEPS      2018-07-10 <span style="color: #949494;">00:00:00</span>         3 T2m       2018-07-10 <span style="color: #949494;">03:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> AAEPS      2018-07-10 <span style="color: #949494;">00:00:00</span>         6 T2m       2018-07-10 <span style="color: #949494;">06:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7 more variables: level_type &lt;chr&gt;, level &lt;dbl&gt;, units &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   fcst_cycle &lt;chr&gt;, AAEPS_mbr000 &lt;geolist&gt;, AAEPS_mbr002 &lt;geolist&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   AAEPS_mbr004 &lt;geolist&gt;</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="lagged-ensembles">Lagged ensembles<a class="anchor" aria-label="anchor" href="#lagged-ensembles"></a>
</h2>
<p>For lagged ensembles, data are available in harpData for the CMEPS
model in <code>vfld</code> format. <code>vfld</code> files are text
files with gridded data already interpolated to points. The CMEPS
ensemble is quite complex with a number of members available each hour,
but tied to a control member every three hours. harpData has members 0,
1, 3, 4, 5 and 6 where members 0 and 1 are run at hours 0, 3, 6, …, 21;
members 3 and 4 at hours 1, 4, 7, …, 22; and members 5 and 6 at hours 2,
5, 8, …, 23. This means that members 3 and 4 are two hours behind
members 0 and 1, and members 5 and 6 are one hour behind members 0 and
1. The <code>lags</code> argument is used to pass the lagging
information to <code>read_forecast</code> and the lags aer assumed to be
in the same order as the <code>members</code> argument. Note also that
the dates for CMEPS data are different to the ones that have been used
before.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_forecast.html">read_forecast</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/harpCore/man/seq_dttm.html" class="external-link">seq_dttm</a></span><span class="op">(</span><span class="fl">2019021700</span>, <span class="fl">2019021718</span>, <span class="st">"6h"</span><span class="op">)</span>,</span>
<span>  <span class="st">"CMEPS_prod"</span>,</span>
<span>  <span class="st">"T2m"</span>,</span>
<span>  lead_time     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  members       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>  lags          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  file_path     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"vfld"</span>, package <span class="op">=</span> <span class="st">"harpData"</span><span class="op">)</span>,</span>
<span>  file_template <span class="op">=</span> <span class="st">"vfld_eps"</span>,</span>
<span>  return_data   <span class="op">=</span> <span class="cn">TRUE</span> </span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">::ensemble point forecast:: </span><span style="color: #949494;"># A tibble: 22,980 × 16</span></span></span>
<span><span class="co">#&gt;    fcst_model fcst_dttm           lead_time parameter   SID   lat   lon units</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> CMEPS_prod 2019-02-17 <span style="color: #949494;">00:00:00</span>         0 T2m        <span style="text-decoration: underline;">1</span>001  70.9 -<span style="color: #BB0000;">8.67</span> K    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> CMEPS_prod 2019-02-17 <span style="color: #949494;">00:00:00</span>         0 T2m        <span style="text-decoration: underline;">1</span>010  69.3 16.1  K    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> CMEPS_prod 2019-02-17 <span style="color: #949494;">00:00:00</span>         0 T2m        <span style="text-decoration: underline;">1</span>014  69.2 17.9  K    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> CMEPS_prod 2019-02-17 <span style="color: #949494;">00:00:00</span>         0 T2m        <span style="text-decoration: underline;">1</span>015  69.6 17.8  K    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> CMEPS_prod 2019-02-17 <span style="color: #949494;">00:00:00</span>         0 T2m        <span style="text-decoration: underline;">1</span>018  69.2 16.0  K    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> CMEPS_prod 2019-02-17 <span style="color: #949494;">00:00:00</span>         0 T2m        <span style="text-decoration: underline;">1</span>023  69.1 18.5  K    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> CMEPS_prod 2019-02-17 <span style="color: #949494;">00:00:00</span>         0 T2m        <span style="text-decoration: underline;">1</span>025  69.7 18.9  K    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> CMEPS_prod 2019-02-17 <span style="color: #949494;">00:00:00</span>         0 T2m        <span style="text-decoration: underline;">1</span>026  69.7 18.9  K    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> CMEPS_prod 2019-02-17 <span style="color: #949494;">00:00:00</span>         0 T2m        <span style="text-decoration: underline;">1</span>027  69.7 18.9  K    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> CMEPS_prod 2019-02-17 <span style="color: #949494;">00:00:00</span>         0 T2m        <span style="text-decoration: underline;">1</span>033  70.2 19.5  K    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 22,970 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more variables: valid_dttm &lt;dttm&gt;, fcst_cycle &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   CMEPS_prod_mbr000 &lt;dbl&gt;, CMEPS_prod_mbr001 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   CMEPS_prod_mbr003_lag2h &lt;dbl&gt;, CMEPS_prod_mbr004_lag2h &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   CMEPS_prod_mbr005_lag1h &lt;dbl&gt;, CMEPS_prod_mbr006_lag1h &lt;dbl&gt;</span></span></span></code></pre>
<p>You will see that a number of members have NA - this is because
certain combinations of forecast time and lead time do not exist for
those members. When data are in read in from SQLite files using
<code><a href="../reference/read_point_forecast.html">read_point_forecast()</a></code> this information is adjusted to take
care of the lagged members. When working with point data, the most
efficient workflow is to use <code><a href="../reference/read_forecast.html">read_forecast()</a></code> to write the
data to files and then read from the files.</p>
<div class="section level3">
<h3 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h3>
<p><a href="transformations.html">Transforming forecast model
data</a></p>
<p><a href="write_forecast_data.html">Writing forecast model
data</a></p>
<p><a href="file_options.html">Options for file formats</a></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Andrew Singleton, Alex Deckmyn.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
